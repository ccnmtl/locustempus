{% load compress %}

<!DOCTYPE html>

<html lang="en">
    <head>
	    <title>{% block title %}{% endblock %}{{ flatpage.title }} â€“ Locus Tempus</title>

        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- The above 2 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!-- Local CSS -->
        {% compress css %}
        <link href="{{STATIC_URL}}build/main.css" rel="stylesheet">
        {% endcompress %}
        {% block css %}{% endblock %}

        <!-- Standard Meta Data, TBD -->

        <!-- Dublin Core Metadata, TBD -->

        <!-- Open Graph, TBD -->

        <!-- Twitter, TBD -->
        <meta name="twitter:image" content="{{STATIC_URL}}img/favicon.png" />

        <!-- JSON Structured data, TBD -->

        <!-- Favicons, TBD -->
        <link rel="shortcut icon" href="{{STATIC_URL}}img/favicon.ico">
        <link rel="icon" href="{{STATIC_URL}}img/favicon.ico">
        <link rel="icon" type="image/png" href="{{STATIC_URL}}img/favicon.png">

        <meta id="csrf-token" name="csrf-token" content="{{csrf_token}}">
        <script src="{{STATIC_URL}}s3sign/js/s3upload.js"></script>

        <script>
            window.LocusTempus = {
                staticUrl: '{{ STATIC_URL }}',
                baseUrl: '//{{ request.get_host }}',
                {% if not user.is_anonymous %}
                currentUser: {
                    id: {{ request.user.id }},
                },
                {% endif %}
            }
        </script>

        <link rel="stylesheet" href="https://search.sites.columbia.edu/cu-privacy-notice/cu-privacy-notice.css" />
        <script src="https://search.sites.columbia.edu/cu-privacy-notice/cu-privacy-notice.js"></script>
    </head>
    <body class="{{ page_type }}" id="{% block bodyid %}{% endblock %}">

    {% block topnavbar %}
    <header class="header--{% if page_type %}{{ page_type }}{% else %}default{% endif %}">
        <a class="skip-header" href="#content">
            <span class="skip-header__text">Skip to main content</span>
        </a>
        <div class="header__shadow"></div>
        <nav class="navbar py-0 pl-0">
            <a href="/" class="navbar-brand py-0"><img class="header__logo" src="{{STATIC_URL}}img/lt-logo-bgdark.svg" alt="Locus Tempus logo"></a>
        <div class="badge badge-secondary temp-marker">
        <span class="d-none d-xl-inline">Extra large</span>
        <span class="d-none d-lg-inline d-xl-none">Large</span>
        <span class="d-none d-md-inline d-lg-none">Medium</span>
        <span class="d-none d-sm-inline d-md-none">Small</span>
        <span class="d-inline d-sm-none">Extra small</span>
        </div>
            {% block usernav %}
            <div class="user-nav">
                {% if request.user.is_anonymous %}
                <a href="/accounts/login/?next=/" class="lt-button lt-button--transparent" data-cy="sign-in-small">
                    <span class='lt-icons lt-button__icon'><img src="{{STATIC_URL}}img/icon-signin.svg" class="user-nav__icon" /></span>
                    <span class='lt-button__text'>Sign in</span>
                </a>
                {% else %}
                <div class="lt-menu-overflow btn-group">
                    <button type="button" class="lt-button lt-button--transparent dropdown-toggle" data-cy="authenticated-user-choices" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false">
                        <span class='lt-icons lt-button__icon'><img src="{{STATIC_URL}}img/icon-user.svg" class="user-nav__icon" /></span>
                        <span class='lt-button__text'>
                        {% if user.first_name %}
                          Hello, {{ user.first_name }}!
                        {% else %}
                          Hello, {{ user.username }}!
                        {% endif %}
                        </span>
                    </button>
                    <div class="lt-menu lt-menu-overflow--bootstrap dropdown-menu">
                        <ul class="lt-list">
                            <li class="lt-list-item">
                                <a href="{% url 'course-list-view' %}" class="d-flex align-items-center justify-content-start lt-list-item__link">
                                <span class='lt-icons lt-list-item__icon' aria-hidden="true"><img src="{{STATIC_URL}}img/icon-grid.svg" /></span>
                                <span class="lt-list-item__primary-text">Your Workspaces</span>
                                </a>
                            </li>
                            {% if user.is_superuser %}
                            <li class="lt-list-item">
                                <a href="#" class="d-flex align-items-center justify-content-start lt-list-item__link">
                                <span class='lt-icons lt-list-item__icon' aria-hidden="true"><img src="{{STATIC_URL}}img/icon-impersonate.svg" /></span>
                                <span class="lt-list-item__primary-text">Impersonate</span>
                                </a>
                            </li>
                            {% endif %}
                            <li class="lt-list-item border-top">
                                <a href="/accounts/logout/?next=/" class="d-flex align-items-center justify-content-start lt-list-item__link">
                                <span class='lt-icons lt-list-item__icon' aria-hidden="true"><img src="{{STATIC_URL}}img/icon-sign-out.svg" /></span>
                                <span class="lt-list-item__primary-text"><b>Sign out</b></span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endblock %}
        </nav>
    </header>
    {% endblock %}

    <main class="main--{{ page_type }}" id="content">

        {% comment %}Confirmation message box{% endcomment %}
        {% block messages %}
            {% if messages %}
            <div class="lt-alert lt-alert--top alert alert-dismissible fade show" role="status">
                <div class="lt-alert__text">
                    {% for message in messages %}
                        {% if message.level == DEFAULT_MESSAGE_LEVELS.DEBUG %}
                            {{ message|safe }}
                        {% elif message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
                            {{ message|safe }}
                        {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                            {{ message|safe }}
                        {% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}
                            {{ message|safe }}
                        {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                            {{ message|safe }}
                        {% else %} {# for any other message type passed in #}
                            {{ message|safe }}
                        {% endif %}
                    {% endfor %}
                </div>
                <button class="close lt-icon-button lt-button--transparent" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% endif %}
        {% endblock %}

<!-- Dashboard breadcrumb and navigation bar -->        
        {% if breadcrumb %}
        <div class="nav-dashboard">
            <div class="lt-breadcrumb">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb nav-dashboard__h1">
                        {% for title, path in breadcrumb.items %}
                            {% if path == '' %}
                                <li class="breadcrumb-item">{{ title }}</li>
                            {% else %}
                                <li class="breadcrumb-item"><a href="{{ path }}">{{ title }}</a></li>
                            {% endif %}
                        {% endfor %}
                    </ol>
                </nav>
            </div>
            {% block page_actions %}{% endblock %}
        </div>
        {% endif %}
<!-- End Dashboard breadcrumb and navigation bar -->        

        {% block content %}{% endblock %}

    </main>

{% block footer %}
<footer>
    <ul class="navlist--footer">
        <li class="nav-item">
            <a href="#">About Locus Tempus</a>
        </li>
        <li class="nav-item">
            <a href="mailto:ctl-locustempus@columbia.edu" title="Send email to ctl-locustempus@columbia.edu">Contact Us</a>
        </li>
    </ul>

    <span itemscope itemtype="http://schema.org/EducationalOrganization"><a href="http://ctl.columbia.edu" target="_blank" itemprop="url"><img src="{{STATIC_URL}}img/ctl-logo-color.svg" class="footer__logo" alt="" itemprop="logo" /><span class="sr-only" itemprop="name">Center for Teaching and Learning at Columbia University</span></a></span>

</footer>
{% endblock %}

<script src="{{STATIC_URL}}build/main.js"></script>

{% if SENTRY_DSN %}
    <script src="https://browser.sentry-cdn.com/5.9.1/bundle.min.js" integrity="sha384-/x1aHz0nKRd6zVUazsV6CbQvjJvr6zQL2CHbQZf3yoLkezyEtZUpqUNnOLW9Nt3v" crossorigin="anonymous">
    </script>
     Sentry.init({ dsn: '{{ SENTRY_DSN }}'});

     {% if user.is_anonymous %}
     Sentry.configureScope(function(scope) {
         scope.setUser({
            "email": 'none',
            "id": 'anonymous'
         });
     });
     {% else %}
     Sentry.configureScope(function(scope) {
         scope.setUser({
            "email": {{ user.email }},
            "id": '{{ user.username }}'
         });
     });
     {% endif %}
    </script>
{% endif %}

{% block js %}{% endblock %}

{% if STAGING_ENV %}
<div class="alert alert-danger alert-dismissable" style="position: fixed; bottom: 0px;">
<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
<h4>Warning: Staging Site</h4>
<p>You are viewing a staging version of this site, not the production site.</p>
<p>This site was last updated on: <b>{{STAGING_DEPLOY_TIME}}</b></p>
</div>
{% endif %}

{% if request.user.is_impersonate %}
<div class="alert alert-danger alert-dismissable" style="position: fixed; left: 0px; top: 75px">
<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
You are impersonating.<br />
<a class="btn" href="{% url 'impersonate-stop' %}">stop</a>
</div>
{% endif %}

{% if GA_CODE %}
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '{{GA_CODE}}', 'columbia.edu');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');
</script>
{% endif %}
</body>
</html>
