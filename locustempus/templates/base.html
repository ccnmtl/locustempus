{% load compress %}

<!DOCTYPE html>

<html lang="en">
    <head>
	    <title>Locus Tempus: {% block title %}{% endblock %}{{ flatpage.title }}</title>

        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- The above 2 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!-- Local CSS -->
        {% compress css %}
        <link href="{{STATIC_URL}}build/main.css" rel="stylesheet">
        {% endcompress %}
        {% block css %}{% endblock %}

        <!-- Standard Meta Data, TBD -->

        <!-- Dublin Core Metadata, TBD -->

        <!-- Open Graph, TBD -->

        <!-- Twitter, TBD -->
        <meta name="twitter:image" content="{{STATIC_URL}}img/favicon.png" />

        <!-- JSON Structured data, TBD -->

        <!-- Favicons, TBD -->
        <link rel="shortcut icon" href="{{STATIC_URL}}img/favicon.ico">

    </head>
    <body class="{% block bodyclass %}{% endblock %}" id="{% block bodyid %}{% endblock %}">

    {% block topnavbar %}
    <header class="header--{% block headerclass %}{% endblock %}">
        <a class="skip-header" href="#content">
            <span class="skip-header__text">Skip to main content</span>
        </a>
        <div class="header__shadow"></div>
        <nav class="navbar">
            <a href="/" class="navbar-brand"><img class="header__logo" src="{{STATIC_URL}}img/lt-logo.png" alt="Locus Tempus logo"></a>
            {% block usernav %}
                {% if request.user.is_anonymous %}
                <a href="http://localhost:8000/accounts/login/?next=/" class="user-auth--login">Log in</a>
                {% else %}
                <a href="/dashboard/">Dashboard</a>
                <a href="/accounts/logout/?next=/" class="user-auth--logout">Log out</a>
                {% endif %}
            {% endblock %}
        </nav>
    </header>
{% endblock %}

    <main class="main--{% block mainclass %}{% endblock %}" id="content">
            <div>
            {% block pagetitle %}{% endblock %}
            {% block messages %}
                {% if messages %}
                <div class="row">
                    <div class="col-12">
                        {% for message in messages %}
                            {% if message.level == DEFAULT_MESSAGE_LEVELS.DEBUG %}
                                <div class="alert alert-secondary">
                                    {{ message|safe }}
                                </div>
                            {% elif message.level == DEFAULT_MESSAGE_LEVELS.INFO %}
                                <div class="alert alert-primary">
                                    {{ message|safe }}
                                </div>
                            {% elif message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}
                                <div class="alert alert-success">
                                    {{ message|safe }}
                                </div>
                            {% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}
                                <div class="alert alert-warning">
                                    {{ message|safe }}
                                </div>
                            {% elif message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}
                                <div class="alert alert-danger">
                                    {{ message|safe }}
                                </div>
                            {% else %} {# for any other message type passed in #}
                                <div class="alert alert-dark">
                                    {{ message|safe }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            {% endblock %}
            {% block content %}{% endblock %}
            </div>
            {# Creates space for a fluid container to be implemented by a map view #}
            {% block fluid_content %}{% endblock %}

    </main>

{% block footer %}
<footer class="bg-light text-dark pt-2 pb-5">
    <ul class="nav d-flex justify-content-center">
        <li class="nav-item">
            <a class="nav-link" href="#">About</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Help</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Contact</a>
        </li>
    </ul>

    <span itemscope itemtype="http://schema.org/EducationalOrganization"><a href="http://ctl.columbia.edu" target="_blank" itemprop="url"><img src="{{STATIC_URL}}img/logo-ctl-color.png" class="mx-auto d-block img-fluid mt-3" alt="" itemprop="logo" width="290" /><span class="sr-only" itemprop="name">Center for Teaching and Learning at Columbia University</span></a></span>

</footer>
{% endblock %}

<script src="{{STATIC_URL}}build/main.js"></script>

{% if SENTRY_DSN %}
    <script src="https://browser.sentry-cdn.com/5.9.1/bundle.min.js" integrity="sha384-/x1aHz0nKRd6zVUazsV6CbQvjJvr6zQL2CHbQZf3yoLkezyEtZUpqUNnOLW9Nt3v" crossorigin="anonymous">
    </script>
     Sentry.init({ dsn: '{{ SENTRY_DSN }}'});

     {% if user.is_anonymous %}
     Sentry.configureScope(function(scope) {
         scope.setUser({
            "email": 'none',
            "id": 'anonymous'
         });
     });
     {% else %}
     Sentry.configureScope(function(scope) {
         scope.setUser({
            "email": {{ user.email }},
            "id": '{{ user.username }}'
         });
     });
     {% endif %}
    </script>
{% endif %}

{% block js %}{% endblock %}

{% if STAGING_ENV %}
<div class="alert alert-danger alert-dismissable" style="position: fixed; bottom: 0px;">
<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
<h4>Warning: Staging Site</h4>
<p>You are viewing a staging version of this site, not the production site.</p>
<p>This site was last updated on: <b>{{STAGING_DEPLOY_TIME}}</b></p>
</div>
{% endif %}

{% if request.user.is_impersonate %}
<div class="alert alert-danger alert-dismissable" style="position: fixed; left: 0px; top: 75px">
<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
You are impersonating.<br />
<a class="btn" href="{% url 'impersonate-stop' %}">stop</a>
</div>
{% endif %}

{% if GA_CODE %}
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '{{GA_CODE}}', 'columbia.edu');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');
</script>
{% endif %}
</body>
</html>
