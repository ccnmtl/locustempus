{% extends 'base.html' %}
{% load course_description course_faculty_string from course_tools %}

{% block title %}
{{ course.title }}
{% endblock %}

{% block page_actions %}
    <div class="lt-dashboard_actions">
        {% if is_faculty %}
        <div class="lt-menu-overflow">
            <button type="button" data-cy="manage-workspace" class="lt-button mr-4 dropdown-toggle" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false">
                <span class='lt-icons lt-button__icon'><img src="{{STATIC_URL}}img/icon-cog.svg" class="active" /></span>
                <span class='lt-button__label'>Manage</span>
            </button>
            <div class="lt-menu lt-menu-overflow--bootstrap dropdown-menu">
                <ul class="lt-list">
                    <li class="lt-list-item">
                        <a data-cy="edit-workspace" href="{% url 'course-edit-view' course.pk %}" class="d-flex align-items-center justify-content-start lt-list-item__link">
                        <span class='lt-icons lt-list-item__icon' aria-hidden="true"><img src="{{STATIC_URL}}img/icon-pencil.svg" class="active" /></span>
                        <span class="lt-list-item__primary-text">Edit Workspace</span>
                        </a>
                    </li>
                    <li class="lt-list-item">
                        <a data-cy="manage-workspace-roster" href="{% url 'course-roster-view' course.pk %}" class="d-flex align-items-center justify-content-start lt-list-item__link">
                        <span class='lt-icons lt-list-item__icon' aria-hidden="true"><img src="{{STATIC_URL}}img/icon-roster.svg" class="active" /></span>
                        <span class="lt-list-item__primary-text">Manage Roster</span>
                        </a>
                    </li>
                    <li class="lt-list-item border-top">
                        <a data-cy="delete-workspace" href="{% url 'course-delete-view' course.pk %}" class="d-flex align-items-center justify-content-start lt-list-item__link">
                        <span class='lt-icons lt-list-item__icon' aria-hidden="true"><img src="{{STATIC_URL}}img/icon-trash.svg" class="active" /></span>
                        <span class="lt-list-item__primary-text">Delete Workspace</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        {% endif %}
        <form method="post" class="lt-layout-toggle">
            {% csrf_token %}
            <button type="submit" class="lt-button mr-1 {% if project_grid_layout %}active{% endif %}" {% if project_grid_layout %}disabled{% endif %}>
                <span class='lt-icons lt-button__icon'><img src="{{STATIC_URL}}img/icon-grid.svg" /></span>
                <span class='lt-button__label'>Grid</span>
            </button>
            <button type="submit" class="lt-button {% if not project_grid_layout %}active{% endif %}" {% if not project_grid_layout %}disabled{% endif %}>
                <span class='lt-icons lt-button__icon'><img src="{{STATIC_URL}}img/icon-list.svg" /></span>
                <span class='lt-button__label'>List</span>
            </button>
        </form>
    </div>
{% endblock %}

{% block content %}

{% if is_faculty and projects %}
<div class="pt-3 px-3">
    <form action="{% url 'course-project-create' course.pk %}" method="post">
        {% csrf_token %}
        <button data-cy="project-create-button" class="lt-button lt-button--solid">
            <span class='lt-icons lt-button__icon lt-button--svg'><img src="{{STATIC_URL}}img/icon-plus-circle.svg" /></span><span class='lt-button__label'>Create New Project</span>
        </button>
    </form>
</div>
{% endif %}

<div class="row dashboard-container" data-cy="project-list">
    <p>Authors: {{ course | course_faculty_string }}</p>
    <p>Description: {{ course | course_description }}</p>
    <p>Term: {% if course.info.termyear %}{{ course.info.termyear }}{% else %} None {% endif %}</p>
    <p>User Role: Youâ€™re {% if user in course.faculty %}an Author.{% else %}a Contributor.{% endif %}</p>
    {% comment %}Projects cards{% endcomment %}
    {% if projects %}
        {% if project_grid_layout %}
            {% for project in projects %}
            <div class="col-md-6 col-xl-4 py-2">
                <div class="lt-card" data-cy="project-card">
                    <div class="lt-card__body">
                        <h3 class="lt-card__title"><a data-cy="project-title-link"  href="{% url 'course-project-detail' course.pk project.pk %}">{{ project.title }}</a></h3>
                        <p class="lt-card__term">Created on {{ project.created_at }}</p>
                        <p class="lt-card__text">{{ project.description|striptags|truncatechars:140}}</p>
                        <ul class="list-group list-group-horizontal-sm lt-card__list-group">
                            <li class="list-group-item lt-card__list-group-item text-muted">Status TBD</li> {# not hooked up #}
                            <li class="list-group-item lt-card__list-group-item">
                            {% if project.activity %}
                                1 Activity
                            {% else %}
                                No Activity
                            {% endif %}
                            </li>
                            {% if user not in course.faculty and project.activity %}
                                <li class="list-group-item lt-card__list-group-item text-muted">
                                    Status: {{ project.response_status }} {# Could be: None, 'DRAFT', 'SUBMITTED', 'REVIEWED' #}
                                </li>
                            {% endif %}
                            {% if user in course.faculty and project.activity %}
                                <li class="list-group-item lt-card__list-group-item text-muted">
                                    Responses: {{ project.activity.submitted_response_count }}
                                </li>
                                <li class="list-group-item lt-card__list-group-item text-muted">
                                    Feedback: {{ project.activity.feedback_count }}
                                </li>
                            {% endif %}
                            <li class="list-group-item lt-card__list-group-item text-muted">TBD</li> {# not hooked up #}
                        </ul>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <table class="table table-bordered tablesorter" id="projects__table">
                <thead>
                    <tr>
                        <th scope="col">Project</th>
                        <th scope="col" class="text-nowrap">Date created</th>
                        <th scope="col" class="sorter-false">Description</th>
                        <th scope="col">Status</th>
                        <th scope="col">Activity</th>
                        <th scope="col" class="sorter-false text-nowrap">Other info</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in projects %}
                    <tr>
                        <td><a href="{% url 'course-project-detail' course.pk project.pk %}">{{ project.title }}</a></td>
                        <td>{{ project.created_at }}</td>
                        <td>{{ project.description|striptags|truncatechars:140}}</td>
                        <td class="text-muted">Status TBD</td>
                        <td class="text-nowrap">
                            {% if project.activity %}
                                1 Activity
                            {% else %}
                                No Activity                       
                            {% endif %}
                        </td>
                        <td class="text-muted">TBD</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}        
    {% else %}
        {% if is_faculty %}
        <div class="create-prompt" data-cy="create-projects-prompt">
            <div class="create-prompt__decor">
                <img src="{{STATIC_URL}}img/prompt-project.svg" />
            </div>
            <div class="create-prompt__content">
                <div class="create-prompt__alert" role="alert">
                  There are no Projects in this Workspace
                </div>
                <p class="create-prompt__instructions">
                You can start by creating one
                </p>
            <form action="{% url 'course-project-create' course.pk %}" method="post">
                {% csrf_token %}
                <button data-cy="project-create-button" class="lt-button lt-button--solid">
                    <span class='lt-icons lt-button__icon lt-button--svg'><img src="{{STATIC_URL}}img/icon-plus-circle.svg" /></span><span class='lt-button__label'>Create New Project</span>
                </button>
            </form>
            </div>
        </div>
        {% else %}
        <div class="create-prompt">
            <div class="create-prompt__decor">
                <img src="{{STATIC_URL}}img/prompt-project.svg" />
            </div>
            <div class="create-prompt__content">
                <div class="create-prompt__alert" role="alert">
                  There are no shared Projects in this Workspace
                </div>
            </div>
        </div>
        {% endif %}
    {% endif %}
</div>


{% endblock %}
